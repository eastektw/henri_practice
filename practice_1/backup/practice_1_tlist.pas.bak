unit practice_1_TList;

{$mode objfpc}{$H+}

interface

uses
  Classes, SysUtils, practice_1_tools, Dialogs;

type
  KeyValuePairRecord=Record
    Key: String;
    Value: String;
  end;
  PLineRecord=^TLineRecord;
  TLineRecord=Record
    Prefix: String;
    Name: String;
    KeyValuePairs: Array of KeyValuePairRecord;
    ItemCount: Integer;
  end;

procedure ConvertLineIntoLineRecord(Line: String; LineRecordPointer: PLineRecord);
procedure ReadFileIntoTList(InTList: TList; FileName: String);

implementation

procedure ReadFileIntoTList(InTList: TList; FileName: String);
var
  MyFile: TextFile;
  LineRecordPt: PLineRecord;
  TempText, PreviousText: String;
  TempInt: Integer;
  LineFinished: Boolean;
begin
  try
    AssignFile(MyFile, FileName);
    Reset(MyFile);
  except
    ShowMessage('Unknown error encountered while reading the file');
  end;

  LineFinished:=True;

  while not EOF(MyFile) do
  begin
    ReadLn(MyFile, TempText);
    if Length(TempText)=0 then continue;

    if not LineFinished then TempText:=PreviousText+TempText;

    TempInt:=pos('\', TempText);
    if TempInt <> 0 then
    begin
      LineFinished:=False;
      Delete(TempText, TempInt, TempInt);
      PreviousText:=TempText;
      continue;
    end
    else
    begin
      LineFinished:=True;
      new(LineRecordPt);
      ConvertLineIntoLineRecord(TempText, LineRecordPt);
      InTList.Add(LineRecordPt);
    end;
  end;
CloseFile(MyFile);
end;

end.

